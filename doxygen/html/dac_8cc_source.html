<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PIC SID Project: musictools/libsidplayfp-2.0.1/src/builders/resid-builder/resid/dac.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PIC SID Project
   &#160;<span id="projectnumber">prototype</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dac_8cc_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">dac.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dac_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//  ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  This file is part of reSID, a MOS6581 SID emulator engine.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  Copyright (C) 2010  Dag Lem &lt;resid@nimrod.no&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//  the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//  (at your option) any later version.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//  This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//  GNU General Public License for more details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//  along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//  ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="dac_8cc.html#a67cb9f4dd4553a1746fb75036e93a875">   20</a></span>&#160;<span class="preprocessor">#define RESID_DAC_CC</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifdef _M_ARM</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#undef _ARM_WINAPI_PARTITION_DESKTOP_SDK_AVAILABLE</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#define _ARM_WINAPI_PARTITION_DESKTOP_SDK_AVAILABLE 1</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="resid-builder_2resid_2dac_8h.html">dac.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#ifdef __IBMC__</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;float.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#define INFINITY _INF</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifndef INFINITY</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html">   36</a></span>&#160;<span class="keyword">union </span><a class="code" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html">MSVC_EVIL_FLOAT_HACK</a></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a78275a2a6acc5c646de81ad37ac35639">   38</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a78275a2a6acc5c646de81ad37ac35639">Bytes</a>[4];</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a4233143a2af04acfac45e32b7b36eef7">   39</a></span>&#160;   <span class="keywordtype">float</span> <a class="code" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a4233143a2af04acfac45e32b7b36eef7">Value</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;};</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">static</span> <span class="keyword">union </span><a class="code" href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html">MSVC_EVIL_FLOAT_HACK</a> INFINITY_HACK = {{0x00, 0x00, 0x80, 0x7F}};</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="dac_8cc.html#a956e2723d559858d08644ac99146e910">   42</a></span>&#160;<span class="preprocessor">#define INFINITY (INFINITY_HACK.Value)</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="namespacere_s_i_d.html">   45</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacere_s_i_d.html">reSID</a></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// Calculation of lookup tables for SID DACs.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// The SID DACs are built up as follows:</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">//          n  n-1      2   1   0    VGND</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//          |   |       |   |   |      |   Termination</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">//         2R  2R      2R  2R  2R     2R   only for</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">//          |   |       |   |   |      |   MOS 8580</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//      Vo  --R---R--...--R---R--    ---</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// All MOS 6581 DACs are missing a termination resistor at bit 0. This causes</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// pronounced errors for the lower 4 - 5 bits (e.g. the output for bit 0 is</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// actually equal to the output for bit 1), resulting in DAC discontinuities</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// for the lower bits.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">// In addition to this, the 6581 DACs exhibit further severe discontinuities</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">// for higher bits, which may be explained by a less than perfect match between</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">// the R and 2R resistors, or by output impedance in the NMOS transistors</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">// providing the bit voltages. A good approximation of the actual DAC output is</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// achieved for 2R/R ~ 2.20.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// The MOS 8580 DACs, on the other hand, do not exhibit any discontinuities.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">// These DACs include the correct termination resistor, and also seem to have</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">// very accurately matched R and 2R resistors (2R/R = 2.00).</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="namespacere_s_i_d.html#a6278ce21d164ffe2667c04fd2b02ced6">   75</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacere_s_i_d.html#a6278ce21d164ffe2667c04fd2b02ced6">build_dac_table</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* <a class="code" href="sidfp_8cpp.html#a1186eb7d27fa9db755beb012c100e912">dac</a>, <span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>, <span class="keywordtype">double</span> _2R_div_R, <span class="keywordtype">bool</span> term)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// FIXME: No variable length arrays in ISO C++, hardcoding to max 12 bits.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// double vbit[bits];</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">double</span> vbit[12];</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// Calculate voltage contribution by each individual bit in the R-2R ladder.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> set_bit = 0; set_bit &lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>; set_bit++) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">double</span> Vn = 1.0;          <span class="comment">// Normalized bit voltage.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a> = 1.0;           <span class="comment">// Normalized R</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">double</span> _2R = _2R_div_R*<a class="code" href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a>; <span class="comment">// 2R</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">double</span> Rn = term ?        <span class="comment">// Rn = 2R for correct termination,</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      _2R : <a class="code" href="dac_8cc.html#a956e2723d559858d08644ac99146e910">INFINITY</a>;         <span class="comment">// INFINITY for missing termination.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Calculate DAC &quot;tail&quot; resistance by repeated parallel substitution.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a> &lt; set_bit; <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a>++) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">if</span> (Rn == <a class="code" href="dac_8cc.html#a956e2723d559858d08644ac99146e910">INFINITY</a>) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        Rn = <a class="code" href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a> + _2R;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        Rn = <a class="code" href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a> + _2R*Rn/(_2R + Rn); <span class="comment">// R + 2R || Rn</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Source transformation for bit voltage.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> (Rn == <a class="code" href="dac_8cc.html#a956e2723d559858d08644ac99146e910">INFINITY</a>) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      Rn = _2R;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      Rn = _2R*Rn/(_2R + Rn);  <span class="comment">// 2R || Rn</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      Vn = Vn*Rn/_2R;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Calculate DAC output voltage by repeated source transformation from</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// the &quot;tail&quot;.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">for</span> (++<a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a>; <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a> &lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>; <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a>++) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      Rn += <a class="code" href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordtype">double</span> I = Vn/Rn;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      Rn = _2R*Rn/(_2R + Rn);  <span class="comment">// 2R || Rn</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      Vn = Rn*I;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    vbit[set_bit] = Vn;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// Calculate the voltage for any combination of bits by superpositioning.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; (1 &lt;&lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>); <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespacere_s_i_d.html#a0ebfbb56836febacddd7b7ce73022de7">x</a> = <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">double</span> Vo = 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>; j++) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      Vo += (<a class="code" href="namespacere_s_i_d.html#a0ebfbb56836febacddd7b7ce73022de7">x</a> &amp; 0x1)*vbit[j];</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="namespacere_s_i_d.html#a0ebfbb56836febacddd7b7ce73022de7">x</a> &gt;&gt;= 1;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// Scale maximum output to 2^bits - 1.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="sidfp_8cpp.html#a1186eb7d27fa9db755beb012c100e912">dac</a>[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = (<span class="keywordtype">unsigned</span> <a class="code" href="readme__resid_8txt.html#a1cbedcc33990b77eae61c0e6ee8eaa7d">short</a>)(((1 &lt;&lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a>) - 1)*Vo + 0.5);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;} <span class="comment">// namespace reSID</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aresid-builder_2resid_2dac_8h_html"><div class="ttname"><a href="resid-builder_2resid_2dac_8h.html">dac.h</a></div></div>
<div class="ttc" id="anamespacere_s_i_d_html"><div class="ttname"><a href="namespacere_s_i_d.html">reSID</a></div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00045">dac.cc:45</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_abc96a7397125bd0c724070f4f29be519"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a></div><div class="ttdeci">clks LDA ROR $AF Compressed pitch bit</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l01173">cubase64_1analyzePitch.m:1173</a></div></div>
<div class="ttc" id="asidfp_8cpp_html_a1186eb7d27fa9db755beb012c100e912"><div class="ttname"><a href="sidfp_8cpp.html#a1186eb7d27fa9db755beb012c100e912">dac</a></div><div class="ttdeci">float dac[12]</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00030">sidfp.cpp:30</a></div></div>
<div class="ttc" id="aunion_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k_html_a4233143a2af04acfac45e32b7b36eef7"><div class="ttname"><a href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a4233143a2af04acfac45e32b7b36eef7">MSVC_EVIL_FLOAT_HACK::Value</a></div><div class="ttdeci">float Value</div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00039">dac.cc:39</a></div></div>
<div class="ttc" id="aunion_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k_html"><div class="ttname"><a href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html">MSVC_EVIL_FLOAT_HACK</a></div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00036">dac.cc:36</a></div></div>
<div class="ttc" id="anamespacere_s_i_d_html_a0ebfbb56836febacddd7b7ce73022de7"><div class="ttname"><a href="namespacere_s_i_d.html#a0ebfbb56836febacddd7b7ce73022de7">reSID::x</a></div><div class="ttdeci">double x(PointIter p)</div><div class="ttdef"><b>Definition:</b> <a href="libsidplayfp-2_80_81_2src_2builders_2resid-builder_2resid_2spline_8h_source.html#l00188">spline.h:188</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_a4768c84e70f55a2e17ad2e5c9613881a"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#a4768c84e70f55a2e17ad2e5c9613881a">bits</a></div><div class="ttdeci">bits</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l00043">cubase64_1analyzePitch.m:43</a></div></div>
<div class="ttc" id="aunion_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k_html_a78275a2a6acc5c646de81ad37ac35639"><div class="ttname"><a href="union_m_s_v_c___e_v_i_l___f_l_o_a_t___h_a_c_k.html#a78275a2a6acc5c646de81ad37ac35639">MSVC_EVIL_FLOAT_HACK::Bytes</a></div><div class="ttdeci">unsigned char Bytes[4]</div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00038">dac.cc:38</a></div></div>
<div class="ttc" id="areadme__resid_8txt_html_a1cbedcc33990b77eae61c0e6ee8eaa7d"><div class="ttname"><a href="readme__resid_8txt.html#a1cbedcc33990b77eae61c0e6ee8eaa7d">short</a></div><div class="ttdeci">This is a reverse engineered software emulation of the MOS6581 a full fledged Commodore and a popular SID tune player The VICE home page however reSID should still be of great interest to Commodore nostalgics The emulator engine is cycle emulating the internal operations of the SID chip SID s audio filter is modeled as an actual two integrator loop biquadratic filter circuit The engine has been developed based on available information on sampling of the OSC3 and ENV3 filter and meticulous testing In short</div><div class="ttdef"><b>Definition:</b> <a href="readme__resid_8txt_source.html#l00021">readme_resid.txt:21</a></div></div>
<div class="ttc" id="adac_8cc_html_a956e2723d559858d08644ac99146e910"><div class="ttname"><a href="dac_8cc.html#a956e2723d559858d08644ac99146e910">INFINITY</a></div><div class="ttdeci">#define INFINITY</div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00042">dac.cc:42</a></div></div>
<div class="ttc" id="amusic__notes_8h_html_a5c71a5e59a53413cd6c270266d63b031"><div class="ttname"><a href="music__notes_8h.html#a5c71a5e59a53413cd6c270266d63b031">R</a></div><div class="ttdeci">#define R</div><div class="ttdef"><b>Definition:</b> <a href="music__notes_8h_source.html#l00134">music_notes.h:134</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">for i</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l00246">cubase64_1analyzePitch.m:246</a></div></div>
<div class="ttc" id="anamespacere_s_i_d_html_a6278ce21d164ffe2667c04fd2b02ced6"><div class="ttname"><a href="namespacere_s_i_d.html#a6278ce21d164ffe2667c04fd2b02ced6">reSID::build_dac_table</a></div><div class="ttdeci">void build_dac_table(unsigned short *dac, int bits, double _2R_div_R, bool term)</div><div class="ttdef"><b>Definition:</b> <a href="dac_8cc_source.html#l00075">dac.cc:75</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_1438cc8c1a18e5b5e27392fc9c1a8795.html">musictools</a></li><li class="navelem"><a class="el" href="dir_b546ff86fa4f5b96096d07674c05f7aa.html">libsidplayfp-2.0.1</a></li><li class="navelem"><a class="el" href="dir_50cae758fdbc2c9a67ee6e4c345cb681.html">src</a></li><li class="navelem"><a class="el" href="dir_f5e1cd35a65dbf7f22c48d0e3a14da09.html">builders</a></li><li class="navelem"><a class="el" href="dir_70d26d057fcaf211a8269e1abc8ad89c.html">resid-builder</a></li><li class="navelem"><a class="el" href="dir_24b2db060bad1aa44b8fcb21a2d31c5b.html">resid</a></li><li class="navelem"><a class="el" href="dac_8cc.html">dac.cc</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
