<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PIC SID Project: musictools/GoatTracker_2.75/goattrk2/src/resid-fp/sidfp.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PIC SID Project
   &#160;<span id="projectnumber">prototype</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sidfp_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sidfp.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sidfp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//  ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  This file is part of reSID, a MOS6581 SID emulator engine.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  Copyright (C) 2004  Dag Lem &lt;resid@nimrod.no&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//  the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//  (at your option) any later version.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//  This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//  GNU General Public License for more details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//  along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//  ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sidfp_8h.html">sidfp.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">   23</a></span>&#160;<span class="preprocessor">#define RINGSIZE 2048</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#ifdef __SSE__</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;xmmintrin.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/* tables used by voice/wavegen/envgen */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="wavefp_8h.html#a1186eb7d27fa9db755beb012c100e912">   30</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="sidfp_8cpp.html#a1186eb7d27fa9db755beb012c100e912">dac</a>[12];</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="sidfp_8cpp.html#a0ecafc4787378edaf0f20e76aac90184">   31</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="sidfp_8cpp.html#a0ecafc4787378edaf0f20e76aac90184">env_dac</a>[256];</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="wavefp_8h.html#a3bfc47aa65309464f9e4b3aeefcf036d">   32</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="sidfp_8cpp.html#a3bfc47aa65309464f9e4b3aeefcf036d">wftable</a>[11][4096];</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a6b85e24725d2c65213a731312f15d5fc">   34</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a6b85e24725d2c65213a731312f15d5fc">SIDFP::set_voice_nonlinearity</a>(<span class="keywordtype">float</span> nl)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">/* all voices, waves, etc. share the same tables */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  voice[0].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#a5694a34f91d231304c23cb45a2b1c065">set_nonlinearity</a>(nl);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a5694a34f91d231304c23cb45a2b1c065">set_nonlinearity</a>(nl);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#ade0baaa5b262c9e6e7a5444885439701">rebuild_wftable</a>();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  filter.<a class="code" href="class_filter_f_p.html#a96caecc994ab79ce01147c1e3742ac05">set_nonlinearity</a>(nl);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a5143eaf982cebd6eea361adbdf20d068">   43</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="class_s_i_d_f_p.html#a5143eaf982cebd6eea361adbdf20d068">SIDFP::kinked_dac</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="vector-demo_8c.html#a83a96667fb436e224e8501b7b9bc612c">x</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> nonlinearity, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a29c6f696b49b0cddc6b4f7bbe8d29892">max</a>)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a> = 0.f;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a> = 1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">float</span> weight = 1.f;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> dir = 2.0f * nonlinearity;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a29c6f696b49b0cddc6b4f7bbe8d29892">max</a>; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> ++) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vector-demo_8c.html#a83a96667fb436e224e8501b7b9bc612c">x</a> &amp; <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a>)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a> += weight;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <a class="code" href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a> &lt;&lt;= 1;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        weight *= dir;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a> / (weight / nonlinearity / nonlinearity) * (1 &lt;&lt; <a class="code" href="cubase64__1analyze_pitch_8m.html#a29c6f696b49b0cddc6b4f7bbe8d29892">max</a>);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// Constructor.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#ae62e6f7b670b0f4b6e1d5b43122afbbd">   63</a></span>&#160;<a class="code" href="class_s_i_d_f_p.html#ae62e6f7b670b0f4b6e1d5b43122afbbd">SIDFP::SIDFP</a>()</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">// Initialize pointers.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  sample = 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  fir = 0;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  lastsample[0] = lastsample[1] = lastsample[2] = 0;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  filtercyclegate = 0;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="class_s_i_d_f_p.html#aed36f886b4148e683d1e73664ba10f99">set_sampling_parameters</a>(985248, <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0ae75f716a35c29a4396346d0475dad30b">SAMPLE_INTERPOLATE</a>, 44100);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  bus_value = 0;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  bus_value_ttl = 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="class_s_i_d_f_p.html#aad1fee63f4848ae839246b1af23b8268">input</a>(0);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">// Destructor.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a02a7d9f8f4064ddea65cc760fb3eceb7">   83</a></span>&#160;<a class="code" href="class_s_i_d_f_p.html#a02a7d9f8f4064ddea65cc760fb3eceb7">SIDFP::~SIDFP</a>()</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">delete</span>[] sample;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keyword">delete</span>[] fir;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">// Set chip model.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">   92</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">SIDFP::set_chip_model</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a8b37770414e868331d3cc265d4c08bcd">chip_model</a> model)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    voice[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="class_voice_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">set_chip_model</a>(model);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#ade0baaa5b262c9e6e7a5444885439701">rebuild_wftable</a>();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  filter.<a class="code" href="class_filter_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">set_chip_model</a>(model);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">// SID reset.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">  105</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">SIDFP::reset</a>()</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    voice[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="class_voice_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">reset</a>();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  filter.<a class="code" href="class_filter_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">reset</a>();</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  extfilt.<a class="code" href="class_external_filter_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">reset</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  bus_value = 0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  bus_value_ttl = 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// Write 16-bit sample to audio input.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// NB! The caller is responsible for keeping the value within 16 bits.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">// Note that to mix in an external audio signal, the signal should be</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">// resampled to 1MHz first to avoid sampling noise.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#aad1fee63f4848ae839246b1af23b8268">  124</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#aad1fee63f4848ae839246b1af23b8268">SIDFP::input</a>(<span class="keywordtype">int</span> <a class="code" href="chipchip_8c.html#af07147e3e498f1cc010dc6472a61f1f6">sample</a>)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// Voice outputs are 20 bits. Scale up to match three voices in order</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// to facilitate simulation of the MOS8580 &quot;digi boost&quot; hardware hack.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  ext_in = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>((<a class="code" href="chipchip_8c.html#af07147e3e498f1cc010dc6472a61f1f6">sample</a> &lt;&lt; 4) * 3);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">// Read sample from audio output, 16-bit result.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">// Do not use this directly, rather use the high-quality resampling outputs.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">  135</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">SIDFP::output</a>()</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">/* Scale to roughly -1 .. 1 range. Voices go from -2048 to 2048 or so,</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">   * envelope from 0 to 255, there are 3 voices, and there&#39;s factor of 2</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">   * for resonance. */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">return</span> extfilt.<a class="code" href="class_external_filter_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>() * (1.f / (2047.f * 255.f * 3.0f * 2.0f));</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">// Read registers.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">// Reading a write only register returns the last byte written to any SID</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">// register. The individual bits in this value start to fade down towards</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">// zero after a few cycles. All bits reach zero within approximately</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">// $2000 - $4000 cycles.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">// It has been claimed that this fading happens in an orderly fashion, however</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">// sampling of write only registers reveals that this is not the case.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">// NB! This is not correctly modeled.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">// The actual use of write only registers has largely been made in the belief</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">// that all SID registers are readable. To support this belief the read</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">// would have to be done immediately after a write to the same register</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">// (remember that an intermediate write to another register would yield that</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">// value instead). With this in mind we return the last value written to</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">// any SID register for $2000 cycles without modeling the bit fading.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#ac79f303105acc55d9597a7014d8a26e1">  160</a></span>&#160;<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a> <a class="code" href="class_s_i_d_f_p.html#ac79f303105acc55d9597a7014d8a26e1">SIDFP::read</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a> <a class="code" href="bass__addon_8h.html#ac74d04db1b94e91597c8147a2f90e9af">offset</a>)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="bass__addon_8h.html#ac74d04db1b94e91597c8147a2f90e9af">offset</a>) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">case</span> 0x19:</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> potx.<a class="code" href="class_potentiometer_f_p.html#afad15229939e330518aa81f45cd3d518">readPOT</a>();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">case</span> 0x1a:</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> poty.<a class="code" href="class_potentiometer_f_p.html#afad15229939e330518aa81f45cd3d518">readPOT</a>();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">case</span> 0x1b:</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">return</span> voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a62127fe720d7dc116a9fde87436d7424">readOSC</a>(voice[0].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">case</span> 0x1c:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">return</span> voice[2].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#a42db6c4b71f51dd3f006f296ff2b2fd2">readENV</a>();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> bus_value;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">// Write registers.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a8c1ccef3d45c31f0259717e4a77e4b78">  180</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a8c1ccef3d45c31f0259717e4a77e4b78">SIDFP::write</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a> <a class="code" href="bass__addon_8h.html#ac74d04db1b94e91597c8147a2f90e9af">offset</a>, <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a> <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;{</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  bus_value = <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  bus_value_ttl = 34000;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="bass__addon_8h.html#ac74d04db1b94e91597c8147a2f90e9af">offset</a>) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">case</span> 0x00:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a4989daed8f4be5a9ee7c72b5781adc61">writeFREQ_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">case</span> 0x01:</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#ac5a70f2cb36cf2f625434b7070405182">writeFREQ_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">case</span> 0x02:</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a679de489ee841d255035e28723657722">writePW_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">case</span> 0x03:</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#af170643c424abdffd008aa66de646da4">writePW_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">case</span> 0x04:</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#a9ef0f5f87d8295d8bbbdc1767b4000d9">writeCONTROL_REG</a>(voice[1].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">case</span> 0x05:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#afeabd12b164c3ed7bb215d3be46bb94b">writeATTACK_DECAY</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">case</span> 0x06:</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    voice[0].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#adc4b822fb503209d0f5d113331cd9821">writeSUSTAIN_RELEASE</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">case</span> 0x07:</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a4989daed8f4be5a9ee7c72b5781adc61">writeFREQ_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">case</span> 0x08:</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#ac5a70f2cb36cf2f625434b7070405182">writeFREQ_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">case</span> 0x09:</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a679de489ee841d255035e28723657722">writePW_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">case</span> 0x0a:</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#af170643c424abdffd008aa66de646da4">writePW_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">case</span> 0x0b:</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#a9ef0f5f87d8295d8bbbdc1767b4000d9">writeCONTROL_REG</a>(voice[2].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">case</span> 0x0c:</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#afeabd12b164c3ed7bb215d3be46bb94b">writeATTACK_DECAY</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">case</span> 0x0d:</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    voice[1].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#adc4b822fb503209d0f5d113331cd9821">writeSUSTAIN_RELEASE</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">case</span> 0x0e:</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a4989daed8f4be5a9ee7c72b5781adc61">writeFREQ_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">case</span> 0x0f:</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#ac5a70f2cb36cf2f625434b7070405182">writeFREQ_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">case</span> 0x10:</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a679de489ee841d255035e28723657722">writePW_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">case</span> 0x11:</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#af170643c424abdffd008aa66de646da4">writePW_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">case</span> 0x12:</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#a9ef0f5f87d8295d8bbbdc1767b4000d9">writeCONTROL_REG</a>(voice[0].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, <a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">case</span> 0x13:</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#afeabd12b164c3ed7bb215d3be46bb94b">writeATTACK_DECAY</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">case</span> 0x14:</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    voice[2].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#adc4b822fb503209d0f5d113331cd9821">writeSUSTAIN_RELEASE</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">case</span> 0x15:</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    filter.<a class="code" href="class_filter_f_p.html#a3cd4b0322d027edc7817f4148a63afd0">writeFC_LO</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">case</span> 0x16:</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    filter.<a class="code" href="class_filter_f_p.html#adc5db42a67714673638b6680e729a1aa">writeFC_HI</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">case</span> 0x17:</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    filter.<a class="code" href="class_filter_f_p.html#a936b207fda074a84f9b990e0e0ddaccd">writeRES_FILT</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">case</span> 0x18:</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    filter.<a class="code" href="class_filter_f_p.html#a4a7204d2d82c410541ce5a0da9c6bd26">writeMODE_VOL</a>(<a class="code" href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">// SID voice muting.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a38aa1ca00822fcae08e13c3a98c6c374">  270</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a38aa1ca00822fcae08e13c3a98c6c374">SIDFP::mute</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a> <a class="code" href="bass_8h.html#a3a91b2e55bb14d1ed0f803f0847fc121">channel</a>, <span class="keywordtype">bool</span> enable)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// Only have 3 voices!</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="bass_8h.html#a3a91b2e55bb14d1ed0f803f0847fc121">channel</a> &gt;= 3)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  voice[<a class="code" href="bass_8h.html#a3a91b2e55bb14d1ed0f803f0847fc121">channel</a>].<a class="code" href="class_voice_f_p.html#af5aabd7ce77e2c313d4161cb7bc35af5">mute</a> (enable);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">// Enable filter.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a2b8b78e19e6472c88dcbc00f77de34b6">  282</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a2b8b78e19e6472c88dcbc00f77de34b6">SIDFP::enable_filter</a>(<span class="keywordtype">bool</span> enable)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  filter.<a class="code" href="class_filter_f_p.html#a2b8b78e19e6472c88dcbc00f77de34b6">enable_filter</a>(enable);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">// I0() computes the 0th order modified Bessel function of the first kind.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">// This function is originally from resample-1.5/filterkit.c by J. O. Smith.</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keywordtype">double</span> SIDFP::I0(<span class="keywordtype">double</span> <a class="code" href="vector-demo_8c.html#a83a96667fb436e224e8501b7b9bc612c">x</a>)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;{</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Max error acceptable in I0 could be 1e-6, which gives that 96 dB already.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// I&#39;m overspecify these errors to get a beautiful FFT dump of the FIR.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> I0e = 1<a class="code" href="cubase64__5analyze_noise_8m.html#a30d3b8e44898693b3b5b95b32743e82b">e</a>-10;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a>, u, halfx, temp;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a> = u = <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 1;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  halfx = <a class="code" href="vector-demo_8c.html#a83a96667fb436e224e8501b7b9bc612c">x</a>/2.0;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    temp = halfx/<a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>++;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    u *= temp*temp;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a> += u;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  } <span class="keywordflow">while</span> (u &gt;= I0e*<a class="code" href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">// Setting of SID sampling parameters.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">// Use a clock freqency of 985248Hz for PAL C64, 1022730Hz for NTSC C64.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">// The default end of passband frequency is pass_freq = 0.9*sample_freq/2</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">// for sample frequencies up to ~ 44.1kHz, and 20kHz for higher sample</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">// frequencies.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">// For resampling, the ratio between the clock frequency and the sample</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">// frequency is limited as follows:</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">//   125*clock_freq/sample_freq &lt; 16384</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">// E.g. provided a clock frequency of ~ 1MHz, the sample frequency can not</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">// be set lower than ~ 8kHz. A lower sample frequency would make the</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">// resampling code overfill its 16k sample ring buffer.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">// The end of passband frequency is also limited:</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">//   pass_freq &lt;= 0.9*sample_freq/2</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">// E.g. for a 44.1kHz sampling rate the end of passband frequency is limited</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">// to slightly below 20kHz. This constraint ensures that the FIR table is</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">// not overfilled.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#aed36f886b4148e683d1e73664ba10f99">  335</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_s_i_d_f_p.html#aed36f886b4148e683d1e73664ba10f99">SIDFP::set_sampling_parameters</a>(<span class="keywordtype">double</span> clock_freq, <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0">sampling_method</a> <a class="code" href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt.html#a59a31db1436d75d219a8e2d9b645b3e0">method</a>,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                  <span class="keywordtype">double</span> sample_freq, <span class="keywordtype">double</span> pass_freq)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  filter.<a class="code" href="class_filter_f_p.html#ad4c2882ad8b8bfacdcf9bdaa099df60a">set_clock_frequency</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(clock_freq * 0.5));</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  extfilt.<a class="code" href="class_external_filter_f_p.html#ad4c2882ad8b8bfacdcf9bdaa099df60a">set_clock_frequency</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(clock_freq * 0.5));</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  cycles_per_sample = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(clock_freq / sample_freq);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// FIR initialization is only necessary for resampling.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt.html#a59a31db1436d75d219a8e2d9b645b3e0">method</a> != <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0a3fe21597c3ecad715c9ec36c5becd8ae">SAMPLE_RESAMPLE_INTERPOLATE</a>)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    sampling = <a class="code" href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt.html#a59a31db1436d75d219a8e2d9b645b3e0">method</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">delete</span>[] sample;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keyword">delete</span>[] fir;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    sample = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    fir = 0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    sample_prev = 0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  sample_offset = 0;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// Allocate sample buffer.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span> (!sample)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    sample = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a>*2];</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">// Clear sample buffer.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a>*2; j++)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    sample[j] = 0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  sample_index = 0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">/* Up to 20 kHz or at most 90 % of passband if it&#39;s lower than 20 kHz. */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (pass_freq &gt; 20000)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    pass_freq = 20000;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (2*pass_freq/sample_freq &gt; 0.9)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    pass_freq = 0.9*sample_freq/2;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="comment">// 16 bits -&gt; -96dB stopband attenuation.</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_p_s_i_d_8doc.html#a930f861689f227013a59e377911121a4">A</a> = -20*log10(1.0/(1 &lt;&lt; 16));</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">// For calculation of beta and N see the reference for the kaiserord</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// function in the MATLAB Signal Processing Toolbox:</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">// http://www.mathworks.com/access/helpdesk/help/toolbox/signal/kaiserord.html</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> beta = 0.1102*(<a class="code" href="_p_s_i_d_8doc.html#a930f861689f227013a59e377911121a4">A</a> - 8.7);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> I0beta = I0(beta);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// Since we clock the filter at half the rate, we need to design the FIR</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// with the reduced rate in mind.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">double</span> f_cycles_per_sample = (clock_freq * 0.5)/sample_freq;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">double</span> f_samples_per_cycle = sample_freq/(clock_freq * 0.5);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">double</span> aliasing_allowance = sample_freq / 2 - 20000;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// no allowance to 20 kHz</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (aliasing_allowance &lt; 0)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    aliasing_allowance = 0;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">double</span> transition_bandwidth = sample_freq/2 - pass_freq + aliasing_allowance;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">// The filter order will maximally be 124 with the current constraints.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// N &gt;= (96.33 - 7.95)/(2 * pi * 2.285 * (maxfreq - passbandfreq) &gt;= 123</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment">// The filter order is equal to the number of zero crossings, i.e.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// it should be an even number (sinc is symmetric about x = 0).</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// XXX: analysis indicates that the filter is slighly overspecified by</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">//      there constraints. Need to check why. One possibility is the</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">//      level of audio being in truth closer to 15-bit than 16-bit.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">int</span> N = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((<a class="code" href="_p_s_i_d_8doc.html#a930f861689f227013a59e377911121a4">A</a> - 7.95)/(2 * <a class="code" href="_s_w_mconvert_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2.285 * transition_bandwidth/sample_freq) + 0.5);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    N += N &amp; 1;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// The filter length is equal to the filter order + 1.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// The filter length must be an odd number (sinc is symmetric about x = 0).</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    fir_N = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(N*f_cycles_per_sample) + 1;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    fir_N |= 1;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// Check whether the sample ring buffer would overfill.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span> (fir_N &gt; <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a> - 1)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">/* Error is bound by 1.234 / L^2, so for 16-bit: sqrt(1.234 * (1 &lt;&lt; 16)) */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    fir_RES = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(sqrt(1.234 * (1 &lt;&lt; 16)) / f_cycles_per_sample + 0.5);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  sampling = <a class="code" href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt.html#a59a31db1436d75d219a8e2d9b645b3e0">method</a>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// Allocate memory for FIR tables.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keyword">delete</span>[] fir;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  fir = <span class="keyword">new</span> <span class="keywordtype">float</span>[fir_N*fir_RES];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// The cutoff frequency is midway through the transition band</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">double</span> wc = (pass_freq + transition_bandwidth/2) / sample_freq * <a class="code" href="_s_w_mconvert_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// Calculate fir_RES FIR tables for linear interpolation.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; fir_RES; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordtype">double</span> j_offset = double(<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>)/fir_RES;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// Calculate FIR table. This is the sinc function, weighted by the</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// Kaiser window.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; fir_N; j ++) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordtype">double</span> jx = double(j) - fir_N/2.f - j_offset;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordtype">double</span> wt = wc*jx/f_cycles_per_sample;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordtype">double</span> temp = jx/(fir_N/2);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordtype">double</span> Kaiser =</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    fabs(temp) &lt;= 1 ? I0(beta*sqrt(1 - temp*temp))/I0beta : 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">// between 1e-7 and 1e-8 the FP result approximates to 1 due to FP limits</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordtype">double</span> sincwt =</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    fabs(wt) &gt;= 1<a class="code" href="cubase64__5analyze_noise_8m.html#a30d3b8e44898693b3b5b95b32743e82b">e</a>-8 ? sin(wt)/wt : 1;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      fir[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> * fir_N + j] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(f_samples_per_cycle*wc/<a class="code" href="_s_w_mconvert_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>*sincwt*Kaiser);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keyword">inline</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordtype">void</span> SIDFP::age_bus_value(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// Age bus value. This is not supposed to be cycle exact,</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">// so it should be safe to approximate.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span> (bus_value_ttl != 0) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    bus_value_ttl -= <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (bus_value_ttl &lt;= 0) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    bus_value = 0;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    bus_value_ttl = 0;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">// SID clocking - 1 cycle.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">  463</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">SIDFP::clock</a>()</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;{</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// Clock amplitude modulators.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 3; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    voice[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">envelope</a>.<a class="code" href="class_envelope_generator_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    voice[<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  voice[0].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a2ce12856abcc74847281241b0f6c7ce1">synchronize</a>(voice[1].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, voice[2].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  voice[1].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a2ce12856abcc74847281241b0f6c7ce1">synchronize</a>(voice[2].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, voice[0].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  voice[2].<a class="code" href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">wave</a>.<a class="code" href="class_waveform_generator_f_p.html#a2ce12856abcc74847281241b0f6c7ce1">synchronize</a>(voice[0].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>, voice[1].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">/* because the analog parts are relatively expensive and do not really need</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">   * the precision of 1 MHz calculations, I average successive samples here to</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">   * reduce the cpu drain for filter calculations and output resampling. */</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordtype">float</span> voicestate[3];</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  voicestate[0] = voice[0].<a class="code" href="class_voice_f_p.html#a58258d573647c7984dca18195964d2ec">output</a>(voice[2].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  voicestate[1] = voice[1].<a class="code" href="class_voice_f_p.html#a58258d573647c7984dca18195964d2ec">output</a>(voice[0].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  voicestate[2] = voice[2].<a class="code" href="class_voice_f_p.html#a58258d573647c7984dca18195964d2ec">output</a>(voice[1].<a class="code" href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">/* for every second sample in sequence, clock filter */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">if</span> (filtercyclegate ++ &amp; 1) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    extfilt.<a class="code" href="class_external_filter_f_p.html#a86da6dde6aab24d7216aea8156aa565b">clock</a>(filter.<a class="code" href="class_filter_f_p.html#a260675022c9b3d8639748ee369c29594">clock</a>(</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      (lastsample[0] + voicestate[0]) * 0.5f,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      (lastsample[1] + voicestate[1]) * 0.5f,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      (lastsample[2] + voicestate[2]) * 0.5f,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      ext_in</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    ));</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  lastsample[0] = voicestate[0];</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  lastsample[1] = voicestate[1];</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  lastsample[2] = voicestate[2];</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">// SID clocking with audio sampling.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">// The example below shows how to clock the SID a specified amount of cycles</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">// while producing audio output:</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">// while (delta_t) {</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">//   bufindex += sid.clock(delta_t, buf + bufindex, buflength - bufindex);</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">//   write(dsp, buf, bufindex*2);</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">//   bufindex = 0;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a03de8f586f4428208c6dc9baa79bc03a">  511</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">SIDFP::clock</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a>&amp; delta_t, <span class="keywordtype">short</span>* buf, <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <span class="keywordtype">int</span> interleave)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">/* XXX I assume n is generally large enough for delta_t here... */</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  age_bus_value(delta_t);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">/* We can only control that SSE is really used for GCC */</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor">#if defined(__SSE__) &amp;&amp; defined(__GNUC__)</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordtype">int</span> old = _mm_getcsr();</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  _mm_setcsr(old | _MM_FLUSH_ZERO_ON);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structres.html">res</a>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">switch</span> (sampling) {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0ae75f716a35c29a4396346d0475dad30b">SAMPLE_INTERPOLATE</a>:</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="structres.html">res</a> = clock_interpolate(delta_t, buf, <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, interleave);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0a3fe21597c3ecad715c9ec36c5becd8ae">SAMPLE_RESAMPLE_INTERPOLATE</a>:</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="structres.html">res</a> = clock_resample_interpolate(delta_t, buf, <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, interleave);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="preprocessor">#if defined(__SSE__) &amp;&amp; defined(__GNUC__)</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  _mm_setcsr(old);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  filter.nuke_denormals();</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  extfilt.nuke_denormals();</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="structres.html">res</a>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno"><a class="line" href="class_s_i_d_f_p.html#a2ac229f68b69d3fa4f367cc644638cde">  541</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="class_s_i_d_f_p.html#a2ac229f68b69d3fa4f367cc644638cde">SIDFP::clock_fast</a>(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a>&amp; delta_t, <span class="keywordtype">short</span>* buf, <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <span class="keywordtype">int</span> interleave)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  age_bus_value(delta_t);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="preprocessor">#if defined(__SSE__) &amp;&amp; defined(__GNUC__)</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordtype">int</span> old = _mm_getcsr();</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  _mm_setcsr(old | _MM_FLUSH_ZERO_ON);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structres.html">res</a> = clock_interpolate(delta_t, buf, <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, interleave);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="preprocessor">#if defined(__SSE__) &amp;&amp; defined(__GNUC__)</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  _mm_setcsr(old);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  filter.nuke_denormals();</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  extfilt.nuke_denormals();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="structres.html">res</a>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">// SID clocking with audio sampling - cycle based with linear sample</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">// interpolation.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">// Here the chip is clocked every cycle. This yields higher quality</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">// sound since the samples are linearly interpolated, and since the</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">// external filter attenuates frequencies above 16kHz, thus reducing</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">// sampling noise.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keyword">inline</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordtype">int</span> SIDFP::clock_interpolate(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a>&amp; delta_t, <span class="keywordtype">short</span>* buf, <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;               <span class="keywordtype">int</span> interleave)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a> = 0;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">float</span> next_sample_offset = sample_offset + cycles_per_sample;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">int</span> delta_t_sample = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(next_sample_offset);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (delta_t_sample &gt; delta_t) {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a> &gt;= <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t_sample - 1; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t_sample) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      sample_prev = <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>();</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    delta_t -= delta_t_sample;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    sample_offset = next_sample_offset - delta_t_sample;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">float</span> sample_now = <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordtype">int</span> sample_int = (int)((sample_prev + (sample_offset * (sample_now - sample_prev))) * 32768.0f);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (sample_int &lt; -32768) sample_int = -32768;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> (sample_int &gt; 32767) sample_int = 32767;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    buf[<a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a>++ * interleave] = sample_int;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    sample_prev = sample_now;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t - 1; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    sample_prev = <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  sample_offset -= delta_t;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  delta_t = 0;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> convolve(<span class="keyword">const</span> <span class="keywordtype">float</span> *<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> *<a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a>, <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;{</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a> = 0.f;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="preprocessor">#ifdef __SSE__</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    __m128 out4 = { 0, 0, 0, 0 };</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">/* examine if we can use aligned loads on both pointers -- some x86-32/64</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">     * hackery here ... should use uintptr_t, but that needs --std=C99... */</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordtype">int</span> diff = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a> - <a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a>) &amp; 0xf;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">int</span> a_align = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a>)) &amp; 0xf;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">/* advance if necessary. We can&#39;t let n fall &lt; 0, so no while (n --). */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &gt; 0 &amp;&amp; a_align != 0 &amp;&amp; a_align != 16) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <a class="code" href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a> += (*(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a> ++)) * (*(<a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a> ++));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> --;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    a_align += 4;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (diff == 0) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &gt;= 4) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            out4 = _mm_add_ps(out4, _mm_mul_ps(_mm_load_ps(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a>), _mm_load_ps(<a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a>)));</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a> += 4;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a> += 4;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> -= 4;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">/* loadu is difficult to optimize:</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">         * - using load and movhl tricks to sync the halves was not noticeably</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">         *   faster, less than 1 % and that might have been measurement error.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">         * - preparing copies of b for syncing with any alignment increased</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">         *   memory pressure to the point that cache misses made it slower!</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &gt;= 4) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            out4 = _mm_add_ps(out4, _mm_mul_ps(_mm_load_ps(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a>), _mm_loadu_ps(<a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a>)));</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a> += 4;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a> += 4;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> -= 4;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">/* sum the upper half of values with the lower half, pairwise */</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    out4 = _mm_add_ps(_mm_movehl_ps(out4, out4), out4);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">/* sum the value at slot 1 with the value at slot 0 */</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    out4 = _mm_add_ss(_mm_shuffle_ps(out4, out4, 1), out4);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordtype">float</span> out_tmp;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">/* save slot 0 to out_tmp, which is now 0+1+2+3 */</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    _mm_store_ss(&amp;out_tmp, out4);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a> += out_tmp;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> --)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a> += (*(<a class="code" href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a> ++)) * (*(<a class="code" href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a> ++));</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">// SID clocking with audio sampling - cycle based with audio resampling.</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">// This is the theoretically correct (and computationally intensive) audio</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">// sample generation. The samples are generated by resampling to the specified</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">// sampling frequency. The work rate is inversely proportional to the</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">// percentage of the bandwidth allocated to the filter transition band.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">// This implementation is based on the paper &quot;A Flexible Sampling-Rate</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">// Conversion Method&quot;, by J. O. Smith and P. Gosset, or rather on the</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">// expanded tutorial on the &quot;Digital Audio Resampling Home Page&quot;:</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">// http://www-ccrma.stanford.edu/~jos/resample/</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">// By building shifted FIR tables with samples according to the</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">// sampling frequency, this implementation dramatically reduces the</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">// computational effort in the filter convolutions, without any loss</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">// of accuracy. The filter convolutions are also vectorizable on</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">// current hardware.</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">// Further possible optimizations are:</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">// * An equiripple filter design could yield a lower filter order, see</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">//   http://www.mwrf.com/Articles/ArticleID/7229/7229.html</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">// * The Convolution Theorem could be used to bring the complexity of</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">//   convolution down from O(n*n) to O(n*log(n)) using the Fast Fourier</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">//   Transform, see http://en.wikipedia.org/wiki/Convolution_theorem</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">// * Simply resampling in two steps can also yield computational</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">//   savings, since the transition band will be wider in the first step</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">//   and the required filter order is thus lower in this step.</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">//   Laurent Ganier has found the optimal intermediate sampling frequency</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">//   to be (via derivation of sum of two steps):</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">//     2 * pass_freq + sqrt [ 2 * pass_freq * orig_sample_freq</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">//       * (dest_sample_freq - 2 * pass_freq) / dest_sample_freq ]</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">// NB! the result of right shifting negative numbers is really</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">// implementation dependent in the C++ standard.</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keyword">inline</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="keywordtype">int</span> SIDFP::clock_resample_interpolate(<a class="code" href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a>&amp; delta_t, <span class="keywordtype">short</span>* buf, <span class="keywordtype">int</span> <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>,</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                    <span class="keywordtype">int</span> interleave)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;{</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a> = 0;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordtype">float</span> next_sample_offset = sample_offset + cycles_per_sample;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">/* full clocks left to next sample */</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordtype">int</span> delta_t_sample = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(next_sample_offset);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> (delta_t_sample &gt; delta_t || <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a> &gt;= <a class="code" href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">/* clock forward delta_t_sample samples */</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t_sample; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">if</span> (filtercyclegate &amp; 1) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        sample[sample_index] = sample[sample_index + <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a>] = <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>();</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        ++ sample_index;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        sample_index &amp;= <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a> - 1;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    delta_t -= delta_t_sample;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">/* Phase of the sample in terms of clock, [0 .. 1[. */</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    sample_offset = next_sample_offset - <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(delta_t_sample);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">/* find the first of the nearest fir tables close to the phase */</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordtype">float</span> fir_offset_rmd = sample_offset * fir_RES;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordtype">int</span> fir_offset = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(fir_offset_rmd);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">/* [0 .. 1[ */</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    fir_offset_rmd -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(fir_offset);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">/* find fir_N most recent samples, plus one extra in case the FIR wraps. */</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordtype">float</span>* sample_start = sample + sample_index - fir_N + <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a> - 1;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">float</span> v1 = convolve(sample_start, fir + fir_offset * fir_N, fir_N);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">// Use next FIR table, wrap around to first FIR table using</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// the next sample.</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span> (++ fir_offset == fir_RES) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      fir_offset = 0;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      ++ sample_start;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordtype">float</span> v2 = convolve(sample_start, fir + fir_offset * fir_N, fir_N);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Linear interpolation between the sinc tables yields good approximation</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// for the exact value.</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">int</span> sample_int = (int)((v1 + fir_offset_rmd * (v2 - v1)) * 32768.0f);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span> (sample_int &lt; -32768) sample_int = -32768;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">if</span> (sample_int &gt; 32767) sample_int = 32767;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    buf[<a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a>++ * interleave] = sample_int;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="comment">/* clock forward delta_t samples */</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; delta_t; <a class="code" href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">clock</a>();</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (filtercyclegate &amp; 1) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      sample[sample_index] = sample[sample_index + <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a>] = <a class="code" href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">output</a>();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      ++ sample_index;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      sample_index &amp;= <a class="code" href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a> - 1;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  sample_offset -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(delta_t);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  delta_t = 0;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_voice_f_p_html_a7d0cf64e99ba7d320528da9351a7a379"><div class="ttname"><a href="class_voice_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">VoiceFP::set_chip_model</a></div><div class="ttdeci">void set_chip_model(chip_model model)</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8cpp_source.html#l00033">voicefp.cpp:33</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a3e5fbb678ec2a5180c62b6d38b9bddf0"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0">sampling_method</a></div><div class="ttdeci">sampling_method</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00052">siddefs.h:52</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a5694a34f91d231304c23cb45a2b1c065"><div class="ttname"><a href="class_waveform_generator_f_p.html#a5694a34f91d231304c23cb45a2b1c065">WaveformGeneratorFP::set_nonlinearity</a></div><div class="ttdeci">void set_nonlinearity(float nl)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00192">wavefp.cpp:192</a></div></div>
<div class="ttc" id="asidfp_8cpp_html_a0ff6d080449124d52d868d9ce2ffe871"><div class="ttname"><a href="sidfp_8cpp.html#a0ff6d080449124d52d868d9ce2ffe871">RINGSIZE</a></div><div class="ttdeci">#define RINGSIZE</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00023">sidfp.cpp:23</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a2b8b78e19e6472c88dcbc00f77de34b6"><div class="ttname"><a href="class_s_i_d_f_p.html#a2b8b78e19e6472c88dcbc00f77de34b6">SIDFP::enable_filter</a></div><div class="ttdeci">void enable_filter(bool enable)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00282">sidfp.cpp:282</a></div></div>
<div class="ttc" id="ains2snd2_8c_html_a1277960b5f2b37137fe9b0b5a1ea0beb"><div class="ttname"><a href="ins2snd2_8c.html#a1277960b5f2b37137fe9b0b5a1ea0beb">out</a></div><div class="ttdeci">FILE * out</div><div class="ttdef"><b>Definition:</b> <a href="ins2snd2_8c_source.html#l00019">ins2snd2.c:19</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_ad20897c5c8bd47f5d4005989bead0e55"><div class="ttname"><a href="class_s_i_d_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">SIDFP::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00105">sidfp.cpp:105</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a91c4a467078baf29eb254476f50fa310"><div class="ttname"><a href="class_waveform_generator_f_p.html#a91c4a467078baf29eb254476f50fa310">WaveformGeneratorFP::clock</a></div><div class="ttdeci">void clock()</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8h_source.html#l00099">wavefp.h:99</a></div></div>
<div class="ttc" id="aclass_envelope_generator_f_p_html_a91c4a467078baf29eb254476f50fa310"><div class="ttname"><a href="class_envelope_generator_f_p.html#a91c4a467078baf29eb254476f50fa310">EnvelopeGeneratorFP::clock</a></div><div class="ttdeci">void clock()</div><div class="ttdef"><b>Definition:</b> <a href="envelopefp_8h_source.html#l00090">envelopefp.h:90</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_abc96a7397125bd0c724070f4f29be519"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#abc96a7397125bd0c724070f4f29be519">bit</a></div><div class="ttdeci">clks LDA ROR $AF Compressed pitch bit</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l01173">cubase64_1analyzePitch.m:1173</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_a29c6f696b49b0cddc6b4f7bbe8d29892"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#a29c6f696b49b0cddc6b4f7bbe8d29892">max</a></div><div class="ttdeci">Need to do calculations since memory requirements may get out of hand if doing all at once Must avoid doing global calculations like max(all) or mean(all) % Could use a filter with a bandpass filter with stopband defined from 0 to 120Hz % and passband defined from 140 Hz to 330 Hz. % Specify a passband ripple of 5% % ...but to make things faster</div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_aad1fee63f4848ae839246b1af23b8268"><div class="ttname"><a href="class_s_i_d_f_p.html#aad1fee63f4848ae839246b1af23b8268">SIDFP::input</a></div><div class="ttdeci">void input(int sample)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00124">sidfp.cpp:124</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a91e6b5172145ebb86e17b21e72e2715c"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a91e6b5172145ebb86e17b21e72e2715c">reg8</a></div><div class="ttdeci">unsigned int reg8</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00040">siddefs.h:40</a></div></div>
<div class="ttc" id="aclass_external_filter_f_p_html_ad4c2882ad8b8bfacdcf9bdaa099df60a"><div class="ttname"><a href="class_external_filter_f_p.html#ad4c2882ad8b8bfacdcf9bdaa099df60a">ExternalFilterFP::set_clock_frequency</a></div><div class="ttdeci">void set_clock_frequency(float)</div><div class="ttdef"><b>Definition:</b> <a href="extfiltfp_8cpp_source.html#l00036">extfiltfp.cpp:36</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a2b8b78e19e6472c88dcbc00f77de34b6"><div class="ttname"><a href="class_filter_f_p.html#a2b8b78e19e6472c88dcbc00f77de34b6">FilterFP::enable_filter</a></div><div class="ttdeci">void enable_filter(bool enable)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00047">filterfp.cpp:47</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a4989daed8f4be5a9ee7c72b5781adc61"><div class="ttname"><a href="class_waveform_generator_f_p.html#a4989daed8f4be5a9ee7c72b5781adc61">WaveformGeneratorFP::writeFREQ_LO</a></div><div class="ttdeci">void writeFREQ_LO(reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00221">wavefp.cpp:221</a></div></div>
<div class="ttc" id="asidfp_8cpp_html_a1186eb7d27fa9db755beb012c100e912"><div class="ttname"><a href="sidfp_8cpp.html#a1186eb7d27fa9db755beb012c100e912">dac</a></div><div class="ttdeci">float dac[12]</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00030">sidfp.cpp:30</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a3e5fbb678ec2a5180c62b6d38b9bddf0a3fe21597c3ecad715c9ec36c5becd8ae"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0a3fe21597c3ecad715c9ec36c5becd8ae">SAMPLE_RESAMPLE_INTERPOLATE</a></div><div class="ttdeci">@ SAMPLE_RESAMPLE_INTERPOLATE</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00053">siddefs.h:53</a></div></div>
<div class="ttc" id="asidfp_8cpp_html_a3bfc47aa65309464f9e4b3aeefcf036d"><div class="ttname"><a href="sidfp_8cpp.html#a3bfc47aa65309464f9e4b3aeefcf036d">wftable</a></div><div class="ttdeci">float wftable[11][4096]</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00032">sidfp.cpp:32</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a6b85e24725d2c65213a731312f15d5fc"><div class="ttname"><a href="class_s_i_d_f_p.html#a6b85e24725d2c65213a731312f15d5fc">SIDFP::set_voice_nonlinearity</a></div><div class="ttdeci">void set_voice_nonlinearity(float nl)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00034">sidfp.cpp:34</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_ac79f303105acc55d9597a7014d8a26e1"><div class="ttname"><a href="class_s_i_d_f_p.html#ac79f303105acc55d9597a7014d8a26e1">SIDFP::read</a></div><div class="ttdeci">reg8 read(reg8 offset)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00160">sidfp.cpp:160</a></div></div>
<div class="ttc" id="aclass_external_filter_f_p_html_ad20897c5c8bd47f5d4005989bead0e55"><div class="ttname"><a href="class_external_filter_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">ExternalFilterFP::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="extfiltfp_8cpp_source.html#l00047">extfiltfp.cpp:47</a></div></div>
<div class="ttc" id="asidfp_8cpp_html_a0ecafc4787378edaf0f20e76aac90184"><div class="ttname"><a href="sidfp_8cpp.html#a0ecafc4787378edaf0f20e76aac90184">env_dac</a></div><div class="ttdeci">float env_dac[256]</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00031">sidfp.cpp:31</a></div></div>
<div class="ttc" id="abass_8h_html_a3a91b2e55bb14d1ed0f803f0847fc121"><div class="ttname"><a href="bass_8h.html#a3a91b2e55bb14d1ed0f803f0847fc121">channel</a></div><div class="ttdeci">DWORD channel</div><div class="ttdef"><b>Definition:</b> <a href="bass_8h_source.html#l00552">bass.h:552</a></div></div>
<div class="ttc" id="acubase64__5analyze_noise_8m_html_a30d3b8e44898693b3b5b95b32743e82b"><div class="ttname"><a href="cubase64__5analyze_noise_8m.html#a30d3b8e44898693b3b5b95b32743e82b">e</a></div><div class="ttdeci">All above of max level will be max e</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__5analyze_noise_8m_source.html#l00201">cubase64_5analyzeNoise.m:201</a></div></div>
<div class="ttc" id="achipchip_8c_html_af07147e3e498f1cc010dc6472a61f1f6"><div class="ttname"><a href="chipchip_8c.html#af07147e3e498f1cc010dc6472a61f1f6">sample</a></div><div class="ttdeci">unsigned char sample</div><div class="ttdef"><b>Definition:</b> <a href="chipchip_8c_source.html#l00053">chipchip.c:53</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_ad20897c5c8bd47f5d4005989bead0e55"><div class="ttname"><a href="class_voice_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">VoiceFP::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8cpp_source.html#l00075">voicefp.cpp:75</a></div></div>
<div class="ttc" id="aclass_envelope_generator_f_p_html_adc4b822fb503209d0f5d113331cd9821"><div class="ttname"><a href="class_envelope_generator_f_p.html#adc4b822fb503209d0f5d113331cd9821">EnvelopeGeneratorFP::writeSUSTAIN_RELEASE</a></div><div class="ttdeci">void writeSUSTAIN_RELEASE(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="envelopefp_8cpp_source.html#l00228">envelopefp.cpp:228</a></div></div>
<div class="ttc" id="a64_m_a_p10_8_t_x_t_html_ab2f380f4f9f0408bdfecbf615ad93e68"><div class="ttname"><a href="64_m_a_p10_8_t_x_t.html#ab2f380f4f9f0408bdfecbf615ad93e68">s</a></div><div class="ttdeci">EMPTY ROM containing FF s or AA s</div><div class="ttdef"><b>Definition:</b> <a href="64_m_a_p10_8_t_x_t_source.html#l01389">64MAP10.TXT:1389</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_af5aabd7ce77e2c313d4161cb7bc35af5"><div class="ttname"><a href="class_voice_f_p.html#af5aabd7ce77e2c313d4161cb7bc35af5">VoiceFP::mute</a></div><div class="ttdeci">void mute(bool enable)</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8cpp_source.html#l00085">voicefp.cpp:85</a></div></div>
<div class="ttc" id="a_s_w_mconvert_8c_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="_s_w_mconvert_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="_s_w_mconvert_8c_source.html#l00028">SWMconvert.c:28</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a8b37770414e868331d3cc265d4c08bcd"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a8b37770414e868331d3cc265d4c08bcd">chip_model</a></div><div class="ttdeci">chip_model</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00050">siddefs.h:50</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_a9e26e5f04b0ecaee13afa07c65e82f7a"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#a9e26e5f04b0ecaee13afa07c65e82f7a">a</a></div><div class="ttdeci">rule of thumb for formant estimation a</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l00225">cubase64_1analyzePitch.m:225</a></div></div>
<div class="ttc" id="avector-demo_8c_html_a83a96667fb436e224e8501b7b9bc612c"><div class="ttname"><a href="vector-demo_8c.html#a83a96667fb436e224e8501b7b9bc612c">x</a></div><div class="ttdeci">unsigned char x</div><div class="ttdef"><b>Definition:</b> <a href="vector-demo_8c_source.html#l00005">vector-demo.c:5</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_aed36f886b4148e683d1e73664ba10f99"><div class="ttname"><a href="class_s_i_d_f_p.html#aed36f886b4148e683d1e73664ba10f99">SIDFP::set_sampling_parameters</a></div><div class="ttdeci">bool set_sampling_parameters(double clock_freq, sampling_method method, double sample_freq, double pass_freq=20000)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00335">sidfp.cpp:335</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_ad20897c5c8bd47f5d4005989bead0e55"><div class="ttname"><a href="class_filter_f_p.html#ad20897c5c8bd47f5d4005989bead0e55">FilterFP::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00104">filterfp.cpp:104</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_a9ef0f5f87d8295d8bbbdc1767b4000d9"><div class="ttname"><a href="class_voice_f_p.html#a9ef0f5f87d8295d8bbbdc1767b4000d9">VoiceFP::writeCONTROL_REG</a></div><div class="ttdeci">void writeCONTROL_REG(WaveformGeneratorFP &amp;source, reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8cpp_source.html#l00066">voicefp.cpp:66</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_af07dcfa1754de9040d659f69c0959d8f"><div class="ttname"><a href="class_voice_f_p.html#af07dcfa1754de9040d659f69c0959d8f">VoiceFP::wave</a></div><div class="ttdeci">WaveformGeneratorFP wave</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8h_source.html#l00043">voicefp.h:43</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a3e5fbb678ec2a5180c62b6d38b9bddf0ae75f716a35c29a4396346d0475dad30b"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a3e5fbb678ec2a5180c62b6d38b9bddf0ae75f716a35c29a4396346d0475dad30b">SAMPLE_INTERPOLATE</a></div><div class="ttdeci">@ SAMPLE_INTERPOLATE</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00052">siddefs.h:52</a></div></div>
<div class="ttc" id="a_p_s_i_d_8doc_html_a930f861689f227013a59e377911121a4"><div class="ttname"><a href="_p_s_i_d_8doc.html#a930f861689f227013a59e377911121a4">A</a></div><div class="ttdeci">Read Y in A</div><div class="ttdef"><b>Definition:</b> <a href="_p_s_i_d_8doc_source.html#l00185">PSID.doc:185</a></div></div>
<div class="ttc" id="aclass_potentiometer_f_p_html_afad15229939e330518aa81f45cd3d518"><div class="ttname"><a href="class_potentiometer_f_p.html#afad15229939e330518aa81f45cd3d518">PotentiometerFP::readPOT</a></div><div class="ttdeci">reg8 readPOT()</div><div class="ttdef"><b>Definition:</b> <a href="potfp_8cpp_source.html#l00022">potfp.cpp:22</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_aebe96a6d5e5d15271726fc35af44a476"><div class="ttname"><a href="class_s_i_d_f_p.html#aebe96a6d5e5d15271726fc35af44a476">SIDFP::output</a></div><div class="ttdeci">float output()</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00135">sidfp.cpp:135</a></div></div>
<div class="ttc" id="acubase64__4encode_waveforms_8m_html_a9fef684aaa870adc27303f21f263d344"><div class="ttname"><a href="cubase64__4encode_waveforms_8m.html#a9fef684aaa870adc27303f21f263d344">wave</a></div><div class="ttdeci">Now smooth the Sustain Level so that it _never_ raises the volume unless we re playing a silent wave</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__4encode_waveforms_8m_source.html#l00333">cubase64_4encodeWaveforms.m:333</a></div></div>
<div class="ttc" id="abass__addon_8h_html_a1035fa6ce6de576a06377fdd08bfe16e"><div class="ttname"><a href="bass__addon_8h.html#a1035fa6ce6de576a06377fdd08bfe16e">value</a></div><div class="ttdeci">DWORD void * value</div><div class="ttdef"><b>Definition:</b> <a href="bass__addon_8h_source.html#l00046">bass_addon.h:46</a></div></div>
<div class="ttc" id="astructres_html"><div class="ttname"><a href="structres.html">res</a></div><div class="ttdef"><b>Definition:</b> <a href="parse_8h_source.html#l00053">parse.h:53</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_af170643c424abdffd008aa66de646da4"><div class="ttname"><a href="class_waveform_generator_f_p.html#af170643c424abdffd008aa66de646da4">WaveformGeneratorFP::writePW_HI</a></div><div class="ttdeci">void writePW_HI(reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00236">wavefp.cpp:236</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_ae62e6f7b670b0f4b6e1d5b43122afbbd"><div class="ttname"><a href="class_s_i_d_f_p.html#ae62e6f7b670b0f4b6e1d5b43122afbbd">SIDFP::SIDFP</a></div><div class="ttdeci">SIDFP()</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00063">sidfp.cpp:63</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_adc5db42a67714673638b6680e729a1aa"><div class="ttname"><a href="class_filter_f_p.html#adc5db42a67714673638b6680e729a1aa">FilterFP::writeFC_HI</a></div><div class="ttdeci">void writeFC_HI(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00125">filterfp.cpp:125</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a260675022c9b3d8639748ee369c29594"><div class="ttname"><a href="class_filter_f_p.html#a260675022c9b3d8639748ee369c29594">FilterFP::clock</a></div><div class="ttdeci">float clock(float voice1, float voice2, float voice3, float ext_in)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8h_source.html#l00274">filterfp.h:274</a></div></div>
<div class="ttc" id="asidfp_8h_html"><div class="ttname"><a href="sidfp_8h.html">sidfp.h</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a91c4a467078baf29eb254476f50fa310"><div class="ttname"><a href="class_s_i_d_f_p.html#a91c4a467078baf29eb254476f50fa310">SIDFP::clock</a></div><div class="ttdeci">void clock()</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00463">sidfp.cpp:463</a></div></div>
<div class="ttc" id="abass__addon_8h_html_ac74d04db1b94e91597c8147a2f90e9af"><div class="ttname"><a href="bass__addon_8h.html#ac74d04db1b94e91597c8147a2f90e9af">offset</a></div><div class="ttdeci">DWORD offset</div><div class="ttdef"><b>Definition:</b> <a href="bass__addon_8h_source.html#l00045">bass_addon.h:45</a></div></div>
<div class="ttc" id="aclass_external_filter_f_p_html_a86da6dde6aab24d7216aea8156aa565b"><div class="ttname"><a href="class_external_filter_f_p.html#a86da6dde6aab24d7216aea8156aa565b">ExternalFilterFP::clock</a></div><div class="ttdeci">void clock(float Vi)</div><div class="ttdef"><b>Definition:</b> <a href="extfiltfp_8h_source.html#l00071">extfiltfp.h:71</a></div></div>
<div class="ttc" id="acubase64__4encode_waveforms_8m_html_a21ad0bd836b90d08f4cf640b4c298e7c"><div class="ttname"><a href="cubase64__4encode_waveforms_8m.html#a21ad0bd836b90d08f4cf640b4c298e7c">b</a></div><div class="ttdeci">b</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__4encode_waveforms_8m_source.html#l00312">cubase64_4encodeWaveforms.m:312</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a96caecc994ab79ce01147c1e3742ac05"><div class="ttname"><a href="class_filter_f_p.html#a96caecc994ab79ce01147c1e3742ac05">FilterFP::set_nonlinearity</a></div><div class="ttdeci">void set_nonlinearity(float)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00064">filterfp.cpp:64</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a5143eaf982cebd6eea361adbdf20d068"><div class="ttname"><a href="class_s_i_d_f_p.html#a5143eaf982cebd6eea361adbdf20d068">SIDFP::kinked_dac</a></div><div class="ttdeci">static float kinked_dac(const int x, const float nonlinearity, const int bits)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00043">sidfp.cpp:43</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a8c1ccef3d45c31f0259717e4a77e4b78"><div class="ttname"><a href="class_s_i_d_f_p.html#a8c1ccef3d45c31f0259717e4a77e4b78">SIDFP::write</a></div><div class="ttdeci">void write(reg8 offset, reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00180">sidfp.cpp:180</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_ac5a70f2cb36cf2f625434b7070405182"><div class="ttname"><a href="class_waveform_generator_f_p.html#ac5a70f2cb36cf2f625434b7070405182">WaveformGeneratorFP::writeFREQ_HI</a></div><div class="ttdeci">void writeFREQ_HI(reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00226">wavefp.cpp:226</a></div></div>
<div class="ttc" id="aclass_envelope_generator_f_p_html_afeabd12b164c3ed7bb215d3be46bb94b"><div class="ttname"><a href="class_envelope_generator_f_p.html#afeabd12b164c3ed7bb215d3be46bb94b">EnvelopeGeneratorFP::writeATTACK_DECAY</a></div><div class="ttdeci">void writeATTACK_DECAY(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="envelopefp_8cpp_source.html#l00216">envelopefp.cpp:216</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_ad4c2882ad8b8bfacdcf9bdaa099df60a"><div class="ttname"><a href="class_filter_f_p.html#ad4c2882ad8b8bfacdcf9bdaa099df60a">FilterFP::set_clock_frequency</a></div><div class="ttdeci">void set_clock_frequency(float)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00071">filterfp.cpp:71</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a62127fe720d7dc116a9fde87436d7424"><div class="ttname"><a href="class_waveform_generator_f_p.html#a62127fe720d7dc116a9fde87436d7424">WaveformGeneratorFP::readOSC</a></div><div class="ttdeci">reg8 readOSC(WaveformGeneratorFP &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00273">wavefp.cpp:273</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_ade0baaa5b262c9e6e7a5444885439701"><div class="ttname"><a href="class_waveform_generator_f_p.html#ade0baaa5b262c9e6e7a5444885439701">WaveformGeneratorFP::rebuild_wftable</a></div><div class="ttdeci">void rebuild_wftable()</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00059">wavefp.cpp:59</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a4a7204d2d82c410541ce5a0da9c6bd26"><div class="ttname"><a href="class_filter_f_p.html#a4a7204d2d82c410541ce5a0da9c6bd26">FilterFP::writeMODE_VOL</a></div><div class="ttdeci">void writeMODE_VOL(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00138">filterfp.cpp:138</a></div></div>
<div class="ttc" id="amidi__mapper_8h_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="midi__mapper_8h.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="midi__mapper_8h_source.html#l00059">midi_mapper.h:59</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_ac6d61036f4fc318e9aaa145c16e49e90"><div class="ttname"><a href="class_voice_f_p.html#ac6d61036f4fc318e9aaa145c16e49e90">VoiceFP::envelope</a></div><div class="ttdeci">EnvelopeGeneratorFP envelope</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8h_source.html#l00044">voicefp.h:44</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a2ac229f68b69d3fa4f367cc644638cde"><div class="ttname"><a href="class_s_i_d_f_p.html#a2ac229f68b69d3fa4f367cc644638cde">SIDFP::clock_fast</a></div><div class="ttdeci">int clock_fast(cycle_count &amp;delta_t, short *buf, int n, int interleave=1)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00541">sidfp.cpp:541</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a2ce12856abcc74847281241b0f6c7ce1"><div class="ttname"><a href="class_waveform_generator_f_p.html#a2ce12856abcc74847281241b0f6c7ce1">WaveformGeneratorFP::synchronize</a></div><div class="ttdeci">void synchronize(WaveformGeneratorFP &amp;dest, WaveformGeneratorFP &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8h_source.html#l00135">wavefp.h:135</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a936b207fda074a84f9b990e0e0ddaccd"><div class="ttname"><a href="class_filter_f_p.html#a936b207fda074a84f9b990e0e0ddaccd">FilterFP::writeRES_FILT</a></div><div class="ttdeci">void writeRES_FILT(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00131">filterfp.cpp:131</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a7d0cf64e99ba7d320528da9351a7a379"><div class="ttname"><a href="class_filter_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">FilterFP::set_chip_model</a></div><div class="ttdeci">void set_chip_model(chip_model model)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00057">filterfp.cpp:57</a></div></div>
<div class="ttc" id="aclass_voice_f_p_html_a58258d573647c7984dca18195964d2ec"><div class="ttname"><a href="class_voice_f_p.html#a58258d573647c7984dca18195964d2ec">VoiceFP::output</a></div><div class="ttdeci">float output(WaveformGeneratorFP &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="voicefp_8h_source.html#l00057">voicefp.h:57</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a02a7d9f8f4064ddea65cc760fb3eceb7"><div class="ttname"><a href="class_s_i_d_f_p.html#a02a7d9f8f4064ddea65cc760fb3eceb7">SIDFP::~SIDFP</a></div><div class="ttdeci">~SIDFP()</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00083">sidfp.cpp:83</a></div></div>
<div class="ttc" id="aclass_envelope_generator_f_p_html_a5694a34f91d231304c23cb45a2b1c065"><div class="ttname"><a href="class_envelope_generator_f_p.html#a5694a34f91d231304c23cb45a2b1c065">EnvelopeGeneratorFP::set_nonlinearity</a></div><div class="ttdeci">void set_nonlinearity(float nl)</div><div class="ttdef"><b>Definition:</b> <a href="envelopefp_8cpp_source.html#l00023">envelopefp.cpp:23</a></div></div>
<div class="ttc" id="aclass_external_filter_f_p_html_aebe96a6d5e5d15271726fc35af44a476"><div class="ttname"><a href="class_external_filter_f_p.html#aebe96a6d5e5d15271726fc35af44a476">ExternalFilterFP::output</a></div><div class="ttdeci">float output()</div><div class="ttdef"><b>Definition:</b> <a href="extfiltfp_8h_source.html#l00083">extfiltfp.h:83</a></div></div>
<div class="ttc" id="acubase64__1analyze_pitch_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="cubase64__1analyze_pitch_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">for i</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__1analyze_pitch_8m_source.html#l00246">cubase64_1analyzePitch.m:246</a></div></div>
<div class="ttc" id="acubase64__2correlate_waveforms_8m_html_ae47e734ba8f84b7dceb313053f097ee5"><div class="ttname"><a href="cubase64__2correlate_waveforms_8m.html#ae47e734ba8f84b7dceb313053f097ee5">sum</a></div><div class="ttdeci">worst case sum</div><div class="ttdef"><b>Definition:</b> <a href="cubase64__2correlate_waveforms_8m_source.html#l00392">cubase64_2correlateWaveforms.m:392</a></div></div>
<div class="ttc" id="a_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt_html_a59a31db1436d75d219a8e2d9b645b3e0"><div class="ttname"><a href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt.html#a59a31db1436d75d219a8e2d9b645b3e0">method</a></div><div class="ttdeci">and that you are informed that you can do these things To protect your we need to make restrictions that forbid distributors to deny you these rights or to ask you to surrender these rights These restrictions translate to certain responsibilities for you if you distribute copies of the library or if you modify it For if you distribute copies of the whether gratis or for a you must give the recipients all the rights that we gave you You must make sure that receive or can get the source code If you link other code with the you must provide complete object files to the so that they can relink them with the library after making changes to the library and recompiling it And you must show them these terms so they know their rights We protect your rights with a two step method</div><div class="ttdef"><b>Definition:</b> <a href="_munt_vsti_2_c_o_p_y_i_n_g_8_l_e_s_s_e_r_8txt_source.html#l00049">COPYING.LESSER.txt:49</a></div></div>
<div class="ttc" id="aclass_envelope_generator_f_p_html_a42db6c4b71f51dd3f006f296ff2b2fd2"><div class="ttname"><a href="class_envelope_generator_f_p.html#a42db6c4b71f51dd3f006f296ff2b2fd2">EnvelopeGeneratorFP::readENV</a></div><div class="ttdeci">reg8 readENV()</div><div class="ttdef"><b>Definition:</b> <a href="envelopefp_8cpp_source.html#l00264">envelopefp.cpp:264</a></div></div>
<div class="ttc" id="aclass_filter_f_p_html_a3cd4b0322d027edc7817f4148a63afd0"><div class="ttname"><a href="class_filter_f_p.html#a3cd4b0322d027edc7817f4148a63afd0">FilterFP::writeFC_LO</a></div><div class="ttdeci">void writeFC_LO(reg8)</div><div class="ttdef"><b>Definition:</b> <a href="filterfp_8cpp_source.html#l00119">filterfp.cpp:119</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a7d0cf64e99ba7d320528da9351a7a379"><div class="ttname"><a href="class_s_i_d_f_p.html#a7d0cf64e99ba7d320528da9351a7a379">SIDFP::set_chip_model</a></div><div class="ttdeci">void set_chip_model(chip_model model)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00092">sidfp.cpp:92</a></div></div>
<div class="ttc" id="a_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_html_a64f100d1bad4fc726f157ddbc3b2be6e"><div class="ttname"><a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h.html#a64f100d1bad4fc726f157ddbc3b2be6e">cycle_count</a></div><div class="ttdeci">int cycle_count</div><div class="ttdef"><b>Definition:</b> <a href="_goat_tracker__2_875_2goattrk2_2src_2resid_2siddefs_8h_source.html#l00046">siddefs.h:46</a></div></div>
<div class="ttc" id="aclass_s_i_d_f_p_html_a38aa1ca00822fcae08e13c3a98c6c374"><div class="ttname"><a href="class_s_i_d_f_p.html#a38aa1ca00822fcae08e13c3a98c6c374">SIDFP::mute</a></div><div class="ttdeci">void mute(reg8 channel, bool enable)</div><div class="ttdef"><b>Definition:</b> <a href="sidfp_8cpp_source.html#l00270">sidfp.cpp:270</a></div></div>
<div class="ttc" id="aclass_waveform_generator_f_p_html_a679de489ee841d255035e28723657722"><div class="ttname"><a href="class_waveform_generator_f_p.html#a679de489ee841d255035e28723657722">WaveformGeneratorFP::writePW_LO</a></div><div class="ttdeci">void writePW_LO(reg8 value)</div><div class="ttdef"><b>Definition:</b> <a href="wavefp_8cpp_source.html#l00231">wavefp.cpp:231</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_1438cc8c1a18e5b5e27392fc9c1a8795.html">musictools</a></li><li class="navelem"><a class="el" href="dir_17e68d802e3e325e8707ae00f20adaca.html">GoatTracker_2.75</a></li><li class="navelem"><a class="el" href="dir_20f75f6c12e12f9fba9c33b39b534248.html">goattrk2</a></li><li class="navelem"><a class="el" href="dir_84b122b346a7317a1a20c0062e2c14ca.html">src</a></li><li class="navelem"><a class="el" href="dir_e3c337e58cbbd6ccca47472dc6d4d2ad.html">resid-fp</a></li><li class="navelem"><a class="el" href="sidfp_8cpp.html">sidfp.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
