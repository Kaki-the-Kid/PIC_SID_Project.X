#HerMIDI testbench.stc stimulus-file
#-----------------------------------

stimulus asynchronous_stimulus
 initial_state 1
 #start_cycle 1000
 {
  #simulating how C64 pulls IEC-bus ATN-line low to switch HerMIDI on
  2000,0, 2006,1 
 }
 name ATN_signal
end


stimulus asynchronous_stimulus
 initial_state 1
 {
  #simulating initialization-string DATA sent by C64 to switch on HerMIDI, lower bits first
  # bit0     bit1     bit2     bit3     bit4     bit5     bit6     bit7
   2042,1,  2077,0,  2112,0,  2147,0,  2182,0,  2217,1,  2252,0,  2287,0,  #$21 character "!" 
   2337,0,  2372,0,  2407,0,  2442,0,  2477,1,  2512,1,  2547,0,  2582,0,  #$30 character "0" 
   2632,0,  2667,1,  2702,1,  2737,1,  2772,0,  2807,1,  2842,0,  2877,0,  #$2E character "." 
   2927,1,  2962,0,  2997,0,  3032,0,  3067,1,  3102,1,  3137,0,  3172,0,  #$31 character "1" 
   3222,0,  3257,0,  3292,0,  3327,0,  3362,0,  3397,1,  3432,0,  3467,0,  #$20 character " " 
   3517,1,  3552,0,  3587,1,  3622,0,  3657,0,  3692,1,  3727,1,  3762,0,  #$65 character "e" 
   3812,1,  3847,1,  3882,0,  3917,0,  3952,0,  3987,1,  4022,1,  4057,0,  #$63 character "c" 
   4107,1,  4142,0,  4177,0,  4212,0,  4247,0,  4282,1,  4317,1,  4352,0,  #$61 character "a" 
   4402,0,  4437,1,  4472,1,  4507,0,  4542,0,  4577,1,  4612,1,  4647,0,  #$66 character "f" 
   4697,0,  4732,1,  4767,0,  4802,0,  4837,1,  4872,1,  4907,1,  4942,0,  #$72 character "r" 
   4992,1,  5027,0,  5062,1,  5097,0,  5132,0,  5167,1,  5202,1,  5237,0,  #$65 character "e" 
   5287,0,  5322,0,  5357,1,  5392,0,  5427,1,  5462,1,  5497,1,  5532,0,  #$74 character "t" 
   5582,0,  5617,1,  5652,1,  5687,1,  5722,0,  5757,1,  5792,1,  5827,0,  #$6E character "n" 
   5877,1,  5912,0,  5947,0,  5982,1,  6017,0,  6052,1,  6087,1,  6122,0,  #$69 character "i" 
   6172,0,  6207,0,  6242,0,  6277,0,  6312,0,  6347,1,  6382,0,  6417,0,  #$20 character " " 
   6467,1,  6502,0,  6537,0,  6572,1,  6607,0,  6642,0,  6677,1,  6712,0,  #$49 character "I" 
   6762,0,  6797,0,  6832,1,  6867,0,  6902,0,  6937,0,  6972,1,  7007,0,  #$44 character "D" 
   7057,1,  7092,0,  7127,0,  7162,1,  7197,0,  7232,0,  7267,1,  7302,0,  #$49 character "I" 
   7352,1,  7387,0,  7422,1,  7457,1,  7492,0,  7527,0,  7562,1,  7597,0,  #$4D character "M" 
   7647,0,  7682,1,  7717,0,  7752,0,  7787,1,  7822,1,  7857,1,  7892,0,  #$72 character "r" 
   7942,1,  7977,0,  8012,1,  8047,0,  8082,0,  8117,1,  8152,1,  8187,0,  #$65 character "e" 
   8237,0,  8272,0,  8307,0,  8342,1,  8377,0,  8412,0,  8447,1,  8482,0,  #$48 character "H" 
   8532,0,  8567,0,  8602,0,  8637,0,  8672,0,  8707,1,  8742,0,  8777,0,  #$20 character " " 
   8827,1,  8862,1,  8897,0,  8932,0,  8967,1,  9002,1,  9037,1,  9072,0,  #$73 character "s" 
   9122,0,  9157,0,  9192,1,  9227,0,  9262,0,  9297,1,  9332,1,  9367,0,  #$64 character "d" 
   9417,1,  9452,0,  9487,1,  9522,0,  9557,0,  9592,1,  9627,1,  9662,0,  #$65 character "e" 
   9712,1,  9747,0,  9782,1,  9817,0,  9852,0,  9887,1,  9922,1,  9957,0,  #$65 character "e" 
  10007,0, 10042,1, 10077,1, 10112,1, 10147,0, 10182,1, 10217,1, 10252,0,  #$6E character "n" 
  10302,0, 10337,0, 10372,0, 10407,0, 10442,0, 10477,1, 10512,0, 10547,0,  #$20 character " " 
  10597,0, 10632,0, 10667,1, 10702,0, 10737,1, 10772,1, 10807,0, 10842,0,  #$34 character "4" 
  10892,0, 10927,1, 10962,1, 10997,0, 11032,1, 11067,1, 11102,0, 11137,0,  #$36 character "6" 
  11187,1, 11222,1, 11257,0, 11292,0, 11327,0, 11362,0, 11397,1, 11432,0,  #$43 character "C" 
  11482,1, 11517,0, 11552,0, 11587,1, 11622,1, 11657,0, 11692,0, 11727,1,  #$99 ControlCmd 
  #C64 releases bus, passes its control to HerMIDI 
  11777,0, 
  #simulate that C64 asks for MIDI-event data 
  17000,1 
 }
 name DATA_signal
end


stimulus asynchronous_stimulus
 initial_state 1
 {
  #simulating initialization-string CLK sent by C64 to switch on HerMIDI
  # bit0             bit1             bit2             bit3             bit4             bit5             bit6             bit7
   2048,0, 2054,1,  2083,0, 2089,1,  2118,0, 2124,1,  2153,0, 2159,1,  2188,0, 2194,1,  2223,0, 2229,1,  2258,0, 2264,1,  2293,0, 2299,1,  #$21 ControlCmd 
   2343,0, 2349,1,  2378,0, 2384,1,  2413,0, 2419,1,  2448,0, 2454,1,  2483,0, 2489,1,  2518,0, 2524,1,  2553,0, 2559,1,  2588,0, 2594,1,  #$30 ControlCmd 
   2638,0, 2644,1,  2673,0, 2679,1,  2708,0, 2714,1,  2743,0, 2749,1,  2778,0, 2784,1,  2813,0, 2819,1,  2848,0, 2854,1,  2883,0, 2889,1,  #$2E ControlCmd 
   2933,0, 2939,1,  2968,0, 2974,1,  3003,0, 3009,1,  3038,0, 3044,1,  3073,0, 3079,1,  3108,0, 3114,1,  3143,0, 3149,1,  3178,0, 3184,1,  #$31 ControlCmd 
   3228,0, 3234,1,  3263,0, 3269,1,  3298,0, 3304,1,  3333,0, 3339,1,  3368,0, 3374,1,  3403,0, 3409,1,  3438,0, 3444,1,  3473,0, 3479,1,  #$20 ControlCmd 
   3523,0, 3529,1,  3558,0, 3564,1,  3593,0, 3599,1,  3628,0, 3634,1,  3663,0, 3669,1,  3698,0, 3704,1,  3733,0, 3739,1,  3768,0, 3774,1,  #$65 ControlCmd 
   3818,0, 3824,1,  3853,0, 3859,1,  3888,0, 3894,1,  3923,0, 3929,1,  3958,0, 3964,1,  3993,0, 3999,1,  4028,0, 4034,1,  4063,0, 4069,1,  #$63 ControlCmd 
   4113,0, 4119,1,  4148,0, 4154,1,  4183,0, 4189,1,  4218,0, 4224,1,  4253,0, 4259,1,  4288,0, 4294,1,  4323,0, 4329,1,  4358,0, 4364,1,  #$61 ControlCmd 
   4408,0, 4414,1,  4443,0, 4449,1,  4478,0, 4484,1,  4513,0, 4519,1,  4548,0, 4554,1,  4583,0, 4589,1,  4618,0, 4624,1,  4653,0, 4659,1,  #$66 ControlCmd 
   4703,0, 4709,1,  4738,0, 4744,1,  4773,0, 4779,1,  4808,0, 4814,1,  4843,0, 4849,1,  4878,0, 4884,1,  4913,0, 4919,1,  4948,0, 4954,1,  #$72 ControlCmd 
   4998,0, 5004,1,  5033,0, 5039,1,  5068,0, 5074,1,  5103,0, 5109,1,  5138,0, 5144,1,  5173,0, 5179,1,  5208,0, 5214,1,  5243,0, 5249,1,  #$65 ControlCmd 
   5293,0, 5299,1,  5328,0, 5334,1,  5363,0, 5369,1,  5398,0, 5404,1,  5433,0, 5439,1,  5468,0, 5474,1,  5503,0, 5509,1,  5538,0, 5544,1,  #$74 ControlCmd 
   5588,0, 5594,1,  5623,0, 5629,1,  5658,0, 5664,1,  5693,0, 5699,1,  5728,0, 5734,1,  5763,0, 5769,1,  5798,0, 5804,1,  5833,0, 5839,1,  #$6E ControlCmd 
   5883,0, 5889,1,  5918,0, 5924,1,  5953,0, 5959,1,  5988,0, 5994,1,  6023,0, 6029,1,  6058,0, 6064,1,  6093,0, 6099,1,  6128,0, 6134,1,  #$69 ControlCmd 
   6178,0, 6184,1,  6213,0, 6219,1,  6248,0, 6254,1,  6283,0, 6289,1,  6318,0, 6324,1,  6353,0, 6359,1,  6388,0, 6394,1,  6423,0, 6429,1,  #$20 ControlCmd 
   6473,0, 6479,1,  6508,0, 6514,1,  6543,0, 6549,1,  6578,0, 6584,1,  6613,0, 6619,1,  6648,0, 6654,1,  6683,0, 6689,1,  6718,0, 6724,1,  #$49 ControlCmd 
   6768,0, 6774,1,  6803,0, 6809,1,  6838,0, 6844,1,  6873,0, 6879,1,  6908,0, 6914,1,  6943,0, 6949,1,  6978,0, 6984,1,  7013,0, 7019,1,  #$44 ControlCmd 
   7063,0, 7069,1,  7098,0, 7104,1,  7133,0, 7139,1,  7168,0, 7174,1,  7203,0, 7209,1,  7238,0, 7244,1,  7273,0, 7279,1,  7308,0, 7314,1,  #$49 ControlCmd 
   7358,0, 7364,1,  7393,0, 7399,1,  7428,0, 7434,1,  7463,0, 7469,1,  7498,0, 7504,1,  7533,0, 7539,1,  7568,0, 7574,1,  7603,0, 7609,1,  #$4D ControlCmd 
   7653,0, 7659,1,  7688,0, 7694,1,  7723,0, 7729,1,  7758,0, 7764,1,  7793,0, 7799,1,  7828,0, 7834,1,  7863,0, 7869,1,  7898,0, 7904,1,  #$72 ControlCmd 
   7948,0, 7954,1,  7983,0, 7989,1,  8018,0, 8024,1,  8053,0, 8059,1,  8088,0, 8094,1,  8123,0, 8129,1,  8158,0, 8164,1,  8193,0, 8199,1,  #$65 ControlCmd 
   8243,0, 8249,1,  8278,0, 8284,1,  8313,0, 8319,1,  8348,0, 8354,1,  8383,0, 8389,1,  8418,0, 8424,1,  8453,0, 8459,1,  8488,0, 8494,1,  #$48 ControlCmd 
   8538,0, 8544,1,  8573,0, 8579,1,  8608,0, 8614,1,  8643,0, 8649,1,  8678,0, 8684,1,  8713,0, 8719,1,  8748,0, 8754,1,  8783,0, 8789,1,  #$20 ControlCmd 
   8833,0, 8839,1,  8868,0, 8874,1,  8903,0, 8909,1,  8938,0, 8944,1,  8973,0, 8979,1,  9008,0, 9014,1,  9043,0, 9049,1,  9078,0, 9084,1,  #$73 ControlCmd 
   9128,0, 9134,1,  9163,0, 9169,1,  9198,0, 9204,1,  9233,0, 9239,1,  9268,0, 9274,1,  9303,0, 9309,1,  9338,0, 9344,1,  9373,0, 9379,1,  #$64 ControlCmd 
   9423,0, 9429,1,  9458,0, 9464,1,  9493,0, 9499,1,  9528,0, 9534,1,  9563,0, 9569,1,  9598,0, 9604,1,  9633,0, 9639,1,  9668,0, 9674,1,  #$65 ControlCmd 
   9718,0, 9724,1,  9753,0, 9759,1,  9788,0, 9794,1,  9823,0, 9829,1,  9858,0, 9864,1,  9893,0, 9899,1,  9928,0, 9934,1,  9963,0, 9969,1,  #$65 ControlCmd 
  10013,0,10019,1, 10048,0,10054,1, 10083,0,10089,1, 10118,0,10124,1, 10153,0,10159,1, 10188,0,10194,1, 10223,0,10229,1, 10258,0,10264,1,  #$6E ControlCmd 
  10308,0,10314,1, 10343,0,10349,1, 10378,0,10384,1, 10413,0,10419,1, 10448,0,10454,1, 10483,0,10489,1, 10518,0,10524,1, 10553,0,10559,1,  #$20 ControlCmd 
  10603,0,10609,1, 10638,0,10644,1, 10673,0,10679,1, 10708,0,10714,1, 10743,0,10749,1, 10778,0,10784,1, 10813,0,10819,1, 10848,0,10854,1,  #$34 ControlCmd 
  10898,0,10904,1, 10933,0,10939,1, 10968,0,10974,1, 11003,0,11009,1, 11038,0,11044,1, 11073,0,11079,1, 11108,0,11114,1, 11143,0,11149,1,  #$36 ControlCmd 
  11193,0,11199,1, 11228,0,11234,1, 11263,0,11269,1, 11298,0,11304,1, 11333,0,11339,1, 11368,0,11374,1, 11403,0,11409,1, 11438,0,11444,1,  #$43 ControlCmd 
  11488,0,11494,1, 11523,0,11529,1, 11558,0,11564,1, 11593,0,11599,1, 11628,0,11634,1, 11663,0,11669,1, 11698,0,11704,1, 11733,0,11739,1   #$99 character "@" 
 }
 name CLK_signal
end


#Create a MIDI stimulus-signal for HerMIDI input
stimulus asynchronous_stimulus
 initial_state 1
 #period 22000       #one PAL frame is 20000 of 1 misrosecond cycles, making a little skew to simulate real world
 {#MIDI test-data coming with all various kinds of MIDI messages
  #startbit----bit0-----bit1-----bit2-----bit3-----bit4-----bit5-----bit6-----bit7-----stopbit
  #note-ON
  12879,0  , 12911,0, 12943,1, 12975,0, 13007,0, 13039,1, 13071,0, 13103,0, 13135,1,   13167,1,  #MIDI-byte1 = $92 - noteON (channel2) after 96 cycles
  13199,0  , 13231,0, 13263,1, 13295,0, 13327,1, 13359,1, 13391,0, 13423,1, 13455,0,   13487,1,  #MIDI-byte2 = $5A - note-number after 0 cycles
  13519,0  , 13551,1, 13583,0, 13615,0, 13647,1, 13679,1, 13711,1, 13743,1, 13775,0,   13807,1,  #MIDI-byte3 = $79 - note-velocity after 0 cycles
  #note-OFF
  13871,0  , 13903,1, 13935,1, 13967,0, 13999,1, 14031,0, 14063,0, 14095,0, 14127,1,   14159,1,  #MIDI-byte4 = $8B - noteOFF (channel2) after 32 cycles
  14223,0  , 14255,1, 14287,0, 14319,1, 14351,0, 14383,1, 14415,0, 14447,1, 14479,0,   14511,1,  #MIDI-byte5 = $55 - note-number after 32 cycles
  14575,0  , 14607,0, 14639,0, 14671,0, 14703,1, 14735,0, 14767,0, 14799,1, 14831,0,   14863,1,  #MIDI-byte6 = $48 - note-velocity after 32 cycles
  #2byte-FX
  14959,0  , 14991,1, 15023,0, 15055,1, 15087,1, 15119,0, 15151,0, 15183,1, 15215,1,   15247,1,  #MIDI-byte7 = $CD - patch-change FX (channel13) after 64 cycles
  15317,0  , 15349,0, 15381,0, 15413,1, 15445,0, 15477,1, 15509,0, 15541,0, 15573,0,   15605,1,  #MIDI-byte8 = $14 - patch-number after 38 cycles
  #3byte-FX
  15937,0  , 15969,0, 16001,1, 16033,1, 16065,0, 16097,1, 16129,1, 16161,0, 16193,1,   16225,1,  #MIDI-byte9 = $B6 - CC-FX (channel6) after 300 cycles
  16257,0  , 16289,1, 16321,1, 16353,1, 16385,0, 16417,0, 16449,0, 16481,0, 16513,0,   16545,1,  #MIDI-byte10 = $07 - CC-FX number (volume) after 0 cycles
  16577,0  , 16609,0, 16641,1, 16673,1, 16705,1, 16737,1, 16769,1, 16801,0, 16833,0,   16865,1,  #MIDI-byte11 = $3E - CC-FX value (volume) after 0 cycles
  #1byte-SystemFX
  18897,0  , 18929,0, 18961,1, 18993,1, 19025,1, 19057,1, 19089,1, 19121,1, 19153,1,   19185,1,  #MIDI-byte12 = $FE - Active sensing signal after 2000 cycles
  #2byte-SystemFX
  21185,0  , 21217,1, 21249,1, 21281,0, 21313,0, 21345,1, 21377,1, 21409,1, 21441,1,   21473,1,  #MIDI-byte13 = $F3 - Song-select signal after 1968 cycles
  21583,0  , 21615,1, 21647,1, 21679,0, 21711,0, 21743,0, 21775,0, 21807,0, 21839,0,   21871,1,  #MIDI-byte14 = $03 - Song-number after 78 cycles
  #3byte-SystemFX
  22871,0  , 22903,0, 22935,1, 22967,0, 22999,0, 23031,1, 23063,1, 23095,1, 23127,1,   23159,1,  #MIDI-byte15 = $F2 - Song-position signal after 968 cycles
  23191,0  , 23223,1, 23255,0, 23287,1, 23319,1, 23351,1, 23383,1, 23415,0, 23447,0,   23479,1,  #MIDI-byte16 = $3D - Song-position LSB after 0 cycles
  23511,0  , 23543,0, 23575,1, 23607,1, 23639,0, 23671,0, 23703,1, 23735,0, 23767,0,   23799,1,  #MIDI-byte17 = $26 - Song-position MSB after 0 cycles
  #SysEx-message
  25331,0  , 25363,0, 25395,0, 25427,0, 25459,0, 25491,1, 25523,1, 25555,1, 25587,1,   25619,1,  #MIDI-byte18 = $F0 - System Exclusive message after 1500 cycles
  25651,0  , 25683,1, 25715,1, 25747,0, 25779,0, 25811,1, 25843,1, 25875,0, 25907,0,   25939,1,  #MIDI-byte19 = $33 - System Exclusive message1 (ID) after 0 cycles
  25971,0  , 26003,0, 26035,0, 26067,1, 26099,0, 26131,0, 26163,1, 26195,1, 26227,0,   26259,1,  #MIDI-byte20 = $64 - System Exclusive message2 (data) after 0 cycles
  26291,0  , 26323,1, 26355,1, 26387,1, 26419,1, 26451,1, 26483,1, 26515,1, 26547,0,   26579,1,  #MIDI-byte21 = $7F - System Exclusive message3 (data) after 0 cycles
  26611,0  , 26643,1, 26675,1, 26707,1, 26739,0, 26771,1, 26803,1, 26835,1, 26867,1,   26899,1   #MIDI-byte22 = $F7 - System Exclusive message4 (end) after 0 cycles
 }
 name MIDI_signal
end